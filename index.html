---
layout: page
title: Photos
nowrap: 1
---

<div class="index">
  {% for post in site.posts %}
    <article>
      <div class="meta">
        <span class="date">{{ post.date | date: "%b %-d, %Y" }}</span>
        {% if post.location %}<span class="location">{{ post.location }}</span>{% endif %}
        <h2><a href="{{ post.url | prepend: site.baseurl }}">{{ post.title }}</a></h2>
      </div>

      <section class="gallery">
        {% assign gallery = post.path | split: '/' | last | split: '.' | first %}
        <div class="photo hero">
          {% comment %}
            @TODO: So apparently the "where" filter doesn't work on custom data
            arrays, though I could write a plugin to do it. Instead, we loop over
            the whole post photo array and pull out the hero when we find it. Sadface.
          {% endcomment %}
          {% for photo in site.data.index[gallery].contents %}
            {% if photo.hero %}
              <a href="{{ post.url | prepend: site.baseurl }}">
                <img src="/photo/medium/{{ gallery }}/{{ photo.filename }}" alt="{{ post.title | xml_escape }}" />
              </a>
            {% endif %}
          {% endfor %}
        </div>
        <div class="preview">
          {% assign count = 1 %}
          {% for photo in site.data.index[gallery].contents limit:6 %}
            {% unless photo.hero %}
              <div class="photo">
                <a href="{{ post.url | prepend: site.baseurl }}">
                  <img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" data-src="/photo/mini/{{ gallery }}/{{ photo.filename }}" width="100" height="100" alt="" />
                </a>
              </div>
              {% comment %}
                We use a manual counter here so that we know we'll end
                up with a total of 4 images in .preview but skip the
                hero so that doesn't show up twice.
              {% endcomment %}
              {% assign count = count | plus:1 %}
              {% if count > 4 %}
                {% break %}
              {% endif %}
            {% endunless %}
          {% endfor %}
        </div>
      </section>
    </article>
  {% endfor %}

  {% comment %}
    {% include pagination-links.html %}
  {% endcomment %}
</div>
